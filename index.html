<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#ffd0e5">
  <title>I Have a Question...</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(180deg, #ffd0e5 0%, #ffe8f2 36%, #fff5f9 100%);
      min-height: 100vh;
      min-height: -webkit-fill-available;
      overflow: hidden;
      position: relative;
    }

    /* ===== FLOATING HEARTS BACKGROUND ===== */
    .hearts-container {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .floating-heart {
      position: absolute;
      bottom: -50px;
      opacity: 0.15;
      animation: floatUp linear infinite;
      font-size: 24px;
    }

    @keyframes floatUp {
      0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 0.15; }
      50% { opacity: 0.25; }
      100% { transform: translateY(-110vh) rotate(360deg) scale(0.5); opacity: 0; }
    }

    /* ===== ENVELOPE SCREEN ===== */
    .envelope-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .envelope-screen.hidden {
      opacity: 0;
      transform: scale(1.1);
      pointer-events: none;
    }

    .envelope-tap-text {
      font-size: 18px;
      font-weight: 600;
      color: #bd1e59;
      margin-bottom: 20px;
      animation: fadeInOut 2s ease-in-out infinite;
      text-align: center;
      width: 260px;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }

    /* Envelope CSS */
    .envelope-wrapper {
      cursor: pointer;
      position: relative;
      width: 260px;
      height: 180px;
      margin-top: 10px;
    }

    .envelope-wrapper.opened .envelope {
      overflow: visible;
    }

    .envelope {
      position: relative;
      width: 260px;
      height: 180px;
      border-radius: 10px;
      background: linear-gradient(135deg, #f8a4c8, #f472b6);
      box-shadow: 0 15px 50px rgba(189, 30, 89, 0.3);
      animation: envelopeFloat 3s ease-in-out infinite;
      overflow: hidden;
    }

    @keyframes envelopeFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Envelope flap (triangle on top) */
    .envelope-flap {
      position: absolute;
      top: 0; left: 0;
      width: 0; height: 0;
      border-left: 130px solid transparent;
      border-right: 130px solid transparent;
      border-top: 100px solid #e8459a;
      transform-origin: top center;
      transition: transform 0.6s ease;
      z-index: 3;
    }

    .envelope-wrapper.opened .envelope-flap {
      transform: rotateX(180deg);
    }

    /* Envelope body overlay (bottom triangles to make it look like an envelope) */
    .envelope-front {
      position: absolute;
      bottom: 0; left: 0;
      width: 0; height: 0;
      border-left: 130px solid transparent;
      border-right: 130px solid transparent;
      border-bottom: 110px solid #f06aaa;
      z-index: 4;
    }

    /* Heart seal on envelope */
    .envelope-seal {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 42px;
      z-index: 5;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.15));
      animation: sealPulse 1.5s ease-in-out infinite;
    }

    @keyframes sealPulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.15); }
    }

    /* Letter peeking out */
    .letter {
      position: absolute;
      top: 20px; left: 20px;
      width: 220px;
      height: 150px;
      background: white;
      border-radius: 6px;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.6s ease 0.2s;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .letter-lines {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 20px;
      width: 100%;
    }

    .letter-line {
      height: 6px;
      background: #fce4ec;
      border-radius: 3px;
    }

    .letter-line:nth-child(1) { width: 80%; }
    .letter-line:nth-child(2) { width: 60%; }
    .letter-line:nth-child(3) { width: 70%; }

    .letter-heart {
      text-align: center;
      font-size: 20px;
      margin-top: 4px;
    }

    .envelope-wrapper.opened .letter {
      transform: translateY(-120px);
    }

    /* Envelope subtitle */
    .envelope-subtitle {
      margin-top: 24px;
      font-size: 14px;
      color: #c94f8a;
      font-weight: 600;
      opacity: 0;
      animation: fadeIn 1s ease 1s forwards;
      text-align: center;
      width: 260px;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* ===== QUESTION SCREEN ===== */
    .question-screen {
      display: none;
      position: relative;
      z-index: 1;
    }

    .question-screen.visible {
      display: block;
      animation: fadeInUp 0.8s ease;
    }

    .main {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: -webkit-fill-available;
      padding: 20px;
    }

    .card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      max-width: 400px;
      width: 100%;
    }

    /* GIF display */
    .gif-container {
      width: 250px;
      height: 250px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(189, 30, 89, 0.15);
      margin-bottom: 24px;
      background: #fff;
    }

    .gif-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .question {
      font-size: 26px;
      font-weight: 700;
      color: #bd1e59;
      margin-bottom: 32px;
      line-height: 1.3;
      transition: all 0.3s ease;
    }

    .buttons {
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-yes {
      background: linear-gradient(135deg, #4ade80, #22c55e);
      color: white;
      border: none;
      border-radius: 16px;
      font-family: 'Quicksand', sans-serif;
      font-weight: 700;
      font-size: 20px;
      padding: 14px 32px;
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 1.5s ease-in-out infinite;
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
      min-width: 80px;
    }

    .btn-yes:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4); }
    .btn-yes:active { transform: scale(0.98); }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    .btn-no {
      background: linear-gradient(135deg, #f87171, #ef4444);
      color: white;
      border: none;
      border-radius: 16px;
      font-family: 'Quicksand', sans-serif;
      font-weight: 700;
      font-size: 16px;
      padding: 12px 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
      min-width: 70px;
    }

    .btn-no:hover { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .btn-no:active { transform: scale(0.95); }

    /* Success state */
    .success-message {
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      animation: fadeInUp 0.6s ease;
    }

    .success-message .emoji {
      font-size: 48px;
      margin-bottom: 12px;
      animation: heartBeat 1s ease infinite;
    }

    .success-message .text {
      font-size: 28px;
      font-weight: 700;
      color: #bd1e59;
      line-height: 1.4;
    }

    .success-message .subtext {
      font-size: 18px;
      color: #e84393;
      margin-top: 8px;
      font-weight: 600;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1); }
      75% { transform: scale(1.15); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .shake { animation: shake 0.5s ease; }

    /* Responsive */
    @media (max-height: 700px) {
      .gif-container { width: 200px; height: 200px; }
      .question { font-size: 22px; margin-bottom: 24px; }
      .envelope { width: 220px; height: 150px; }
      .envelope-flap { border-left-width: 110px; border-right-width: 110px; border-top-width: 85px; }
      .envelope-front { border-left-width: 110px; border-right-width: 110px; border-bottom-width: 90px; }
      .letter { width: 180px; height: 120px; }
    }

    @media (max-height: 600px) {
      .gif-container { width: 160px; height: 160px; margin-bottom: 16px; }
      .question { font-size: 20px; margin-bottom: 16px; }
    }
  </style>
</head>
<body>

  <!-- Floating hearts background -->
  <div class="hearts-container" id="heartsContainer"></div>

  <!-- ===== ENVELOPE SCREEN ===== -->
  <div class="envelope-screen" id="envelopeScreen">
    <div class="envelope-tap-text">Tap to open</div>
    <div class="envelope-wrapper" id="envelopeWrapper">
      <div class="envelope">
        <div class="envelope-flap"></div>
        <div class="letter">
          <div class="letter-lines">
            <div class="letter-line"></div>
            <div class="letter-line"></div>
            <div class="letter-line"></div>
            <div class="letter-heart">&#10084;&#65039;</div>
          </div>
        </div>
        <div class="envelope-front"></div>
        <div class="envelope-seal">&#128140;</div>
      </div>
    </div>
    <div class="envelope-subtitle">You have a special message</div>
  </div>

  <!-- ===== QUESTION SCREEN ===== -->
  <div class="question-screen" id="questionScreen">
    <main class="main">
      <section class="card">
        <div class="gif-container">
          <img id="gifDisplay" src="https://media.tenor.com/ADqG6c7X9sUAAAAC/milk-and-mocha-bears-hearts.gif" alt="Cute bear" />
        </div>

        <h1 id="question" class="question">Will you be my Valentine?</h1>

        <div id="buttons" class="buttons">
          <button id="yesBtn" class="btn-yes">Yes!</button>
          <button id="noBtn" class="btn-no">No</button>
        </div>

        <div id="successMsg" class="success-message">
          <div class="emoji">&#10084;&#65039;</div>
          <div class="text">YAYYY!! I knew you'd say yes!</div>
          <div class="subtext">You just made me the happiest person ever</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    (() => {
      /* ===== ENVELOPE LOGIC ===== */
      const envelopeScreen = document.getElementById('envelopeScreen');
      const envelopeWrapper = document.getElementById('envelopeWrapper');
      const questionScreen = document.getElementById('questionScreen');

      envelopeWrapper.addEventListener('click', () => {
        // Open the envelope flap + letter slides up
        envelopeWrapper.classList.add('opened');

        // After envelope animation, transition to question screen
        setTimeout(() => {
          envelopeScreen.classList.add('hidden');
          questionScreen.classList.add('visible');
        }, 1200);
      });

      /* ===== QUESTION LOGIC ===== */
      const yesBtn = document.getElementById('yesBtn');
      const noBtn = document.getElementById('noBtn');
      const gifDisplay = document.getElementById('gifDisplay');
      const question = document.getElementById('question');
      const buttons = document.getElementById('buttons');
      const successMsg = document.getElementById('successMsg');

      const GROWTH = 20;
      const FONT_GROWTH = 4;
      const MAX_CLICKS = 7;

      const GIFS = [
        'https://media.tenor.com/ADqG6c7X9sUAAAAC/milk-and-mocha-bears-hearts.gif',
        'https://media.tenor.com/jT7qt1r8P78AAAAC/milk-and-mocha-bear-finger-heart.gif',
        'https://media.tenor.com/cgZNZOuh6SsAAAAC/sad-bear.gif',
        'https://media.tenor.com/EB_Q8BftsQoAAAAC/crying-bear.gif',
        'https://media.tenor.com/pj-WvOM7W2oAAAAC/mocha-and.gif',
        'https://media.tenor.com/sCckxqr7x2UAAAAC/milk-and-mocha-bear-crying.gif',
        'https://media.tenor.com/xBWyZ70rhlsAAAAC/milk-and-mocha-bears-sad.gif',
        'https://media.tenor.com/VG_hFeD9HHoAAAAC/dance-happy.gif',
      ];

      const NO_MESSAGES = [
        'No',
        'Are you sure? \u{1F97A}',
        'Really really sure?',
        'Love, please...',
        "That's not the right answer!",
        "You're breaking my heart \u{1F494}",
        "I'm gonna cry...",
        "Please? \u{1F62D}\u{1F62D}\u{1F62D}",
      ];

      const QUESTION_MESSAGES = [
        'Will you be my Valentine?',
        'Will you be my Valentine? \u{1F97A}',
        'Pleaseee be my Valentine?',
        'Pretty please with a cherry on top?',
        "C'mon, you know you want to say yes!",
        'I promise to make you smile every day!',
        "There's only one right answer here...",
        'Last chance... Will you be my Valentine?',
      ];

      let noCount = 0;
      let btnH = 48;
      let btnW = 90;
      let fontSize = 20;

      // Preload GIFs
      GIFS.forEach(src => { const img = new Image(); img.src = src; });

      noBtn.addEventListener('click', () => {
        if (noCount >= MAX_CLICKS) {
          noBtn.classList.add('shake');
          setTimeout(() => noBtn.classList.remove('shake'), 500);
          return;
        }

        noCount++;
        gifDisplay.src = GIFS[Math.min(noCount, GIFS.length - 2)];
        question.textContent = QUESTION_MESSAGES[Math.min(noCount, QUESTION_MESSAGES.length - 1)];

        btnH += GROWTH;
        btnW += GROWTH;
        fontSize += FONT_GROWTH;
        yesBtn.style.height = btnH + 'px';
        yesBtn.style.width = btnW + 'px';
        yesBtn.style.fontSize = fontSize + 'px';
        yesBtn.style.padding = '16px 36px';

        const noScale = Math.max(0.5, 1 - noCount * 0.08);
        noBtn.style.transform = 'scale(' + noScale + ')';
        noBtn.textContent = NO_MESSAGES[Math.min(noCount, NO_MESSAGES.length - 1)];

        question.classList.add('shake');
        setTimeout(() => question.classList.remove('shake'), 500);
      });

      yesBtn.addEventListener('click', () => {
        gifDisplay.src = GIFS[GIFS.length - 1];
        buttons.style.display = 'none';
        question.style.display = 'none';
        successMsg.style.display = 'flex';

        // Send emails via EmailJS
        emailjs.init('G401S84SZXuZ0avVm');
        const timeNow = new Date().toLocaleString();
        // Email to her (cute confirmation)
        emailjs.send('service_ublmbws', 'template_8ao22sb', { time: timeNow });
        // Email to you (she said yes!)
        emailjs.send('service_ublmbws', 'template_ff40wds', { time: timeNow });

        const heart = confetti.shapeFromPath({
          path: 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
        });

        const defaults = {
          spread: 360, ticks: 200, gravity: 0.3, decay: 0.95,
          startVelocity: 25, shapes: [heart],
          colors: ['#ff69b4', '#ff1493', '#ff6b81', '#e84393', '#fd79a8', '#e17055'],
          origin: { y: 0.6 },
        };

        confetti({ ...defaults, particleCount: 80, scalar: 2.5 });
        confetti({ ...defaults, particleCount: 40, scalar: 3.5 });
        setTimeout(() => {
          confetti({ ...defaults, particleCount: 60, scalar: 2 });
          confetti({ ...defaults, particleCount: 30, scalar: 4 });
        }, 300);
        setTimeout(() => {
          confetti({ ...defaults, particleCount: 50, scalar: 2.5 });
        }, 600);

        let count = 0;
        const interval = setInterval(() => {
          confetti({ ...defaults, particleCount: 20, scalar: 2, startVelocity: 15 });
          count++;
          if (count > 8) clearInterval(interval);
        }, 800);
      });

      // Floating hearts background
      function createHeart() {
        const container = document.getElementById('heartsContainer');
        const heart = document.createElement('div');
        heart.className = 'floating-heart';
        heart.innerHTML = ['\u2764\uFE0F', '\u{1F495}', '\u{1F497}', '\u{1F49C}', '\u2763\uFE0F'][Math.floor(Math.random() * 5)];
        heart.style.left = Math.random() * 100 + '%';
        heart.style.fontSize = (16 + Math.random() * 20) + 'px';
        heart.style.animationDuration = (8 + Math.random() * 12) + 's';
        heart.style.animationDelay = Math.random() * 2 + 's';
        container.appendChild(heart);
        setTimeout(() => heart.remove(), 22000);
      }

      for (let i = 0; i < 8; i++) setTimeout(createHeart, i * 600);
      setInterval(createHeart, 2000);
    })();
  </script>
</body>
</html>
